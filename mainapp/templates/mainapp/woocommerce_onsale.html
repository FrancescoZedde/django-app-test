{% extends 'mainapp/base.html' %}

{% load crispy_forms_tags %}

{% block content %}

<table class="inventory-table" id="inventory-table">
    <tr class="tr-header">
      <th></th>
      <th></th>
      <th>SKU</th>
      <th>Name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  
    {% for product in products %}
    <tr class="tr-standard">
      <td class="td-id">{{product.id}}</td>
      <td class="td-standard"><img src={{product.mainImage}} alt="" width="100" height="100"></td>
      <td class="td-standard">{{product.sku}}</td>
      <td class="td-name">{{product.name}}</td>
      <td class="td-standard">
        <div class="button" style="text-align: center;margin-bottom:1em;">
            <button class="social-instagram-button" id="open-instagram-modal-{{product.id}}" onClick="retrieve_button_id_and_show_modal(this.id)">Post on Instagram</button>
        </div>
      </td>
      <td class="td-standard">
        <div class="button" style="text-align: center;margin-bottom:1em;">
            <button class="social-facebook-button" id="open-instagram-modal">Post on Facebook</button>
        </div>
      </td>
      <td class="td-standard"><input type="checkbox" name="checkbox-item" onchange=""/>&nbsp;</td>
      <td class="td-standard"><a style='color:rgb(65, 134, 255)' href={{product.url}} target="_blank" rel="follow">URL</a></td>
      <td class="td-standard"><a style='color:rgb(239, 57, 57)' href="">Delete from Woocommerce</a></td>
  
    </tr>
    {% endfor %}
  
  </table>

  <!-- INSTAGRAM CREATE POST MODAL  -->
  <div id="modal-instagram" class="modal-container">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div class="modal-description">
        <h5><b>Create Instagram Post</b></h5>
      </div>
      <div id="" style="margin-top: 1em">
        <!-- INSTAGRAM POST SETUP FORM-->
        <form action="instagram-create-post" method="post">
        {% csrf_token %}
          <div class="row">
            {{ig_post_setup_form}}

          </div>
          <!-- INSTAGRAM POST CREATE BUTTON -->
          <div class="row">
            <div class="col-12" style="text-align:center;">
                <div class="button" style="text-align: center;">
                    <input class="social-instagram-button" style="margin-bottom: 0px !important;" id='create-ig-post' type="submit" value="Publish Now" name="create-ig-post">
                    <p>
                        <small></small>
                    </p>
                    <input type="hidden" id="ig-selected-item" name="ig-selected-item" value="{{ig_selected_item}}">
                </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const modal_instagram = document.getElementById("modal-instagram");
    const close_modal_0 = document.getElementsByClassName("close")[0];

    close_modal_0.onclick = function() {
        modal_instagram.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal_instagram) {
            modal_instagram.style.display = "none";
        }
    }

    function retrieve_button_id_and_show_modal(clicked_id){
        console.log(clicked_id);
        let open_instagram_modal = document.getElementById(clicked_id);
        modal_instagram.style.display = "block";
        let product_id = clicked_id.replace('open-instagram-modal-','');
        document.getElementById("ig-selected-item").value = product_id;
        console.log(document.getElementById("ig-selected-item").value);
    }
  </script>

{% endblock %}